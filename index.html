<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeMaster Pro | Advanced Typing Practice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --gray: #6c757d;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* User Points Display */
        .user-info-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 12px 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .points-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .points-value {
            color: var(--warning);
            font-size: 1.3rem;
        }
        
        .user-name-display {
            font-weight: 600;
            color: var(--success);
        }
        
        .logout-btn {
            background: rgba(249, 65, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(249, 65, 68, 0.3);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .logout-btn:hover {
            background: rgba(249, 65, 68, 0.3);
            transform: translateY(-2px);
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }
        
        .logo {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(67, 97, 238, 0.5); }
            to { text-shadow: 0 0 20px rgba(67, 97, 238, 0.8), 0 0 30px rgba(76, 201, 240, 0.6); }
        }
        
        .tagline {
            font-size: 1.2rem;
            color: var(--success);
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab-btn.active {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 0.8fr 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Simplified Lessons Panel */
        .lessons-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--accent);
        }
        
        .lessons-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .lessons-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .lessons-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .lessons-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .lesson-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .lesson-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }
        
        .lesson-card.active {
            background: rgba(67, 97, 238, 0.2);
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .lesson-card.completed {
            border-left: 5px solid var(--success);
        }
        
        .lesson-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }
        
        .lesson-card.locked::after {
            content: "\f023";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.2rem;
        }
        
        .lesson-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--light);
        }
        
        .lesson-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .lesson-time {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .lesson-difficulty {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .difficulty-beginner { color: var(--success); }
        .difficulty-intermediate { color: var(--warning); }
        .difficulty-advanced { color: var(--accent); }
        .difficulty-expert { color: var(--danger); }
        .difficulty-master { color: #FF00FF; }
        
        .lesson-points {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(248, 150, 30, 0.2);
            color: var(--warning);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Typing Test Area */
        .typing-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stats {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            text-align: center;
            min-width: 80px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .timer {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(248, 37, 133, 0.5);
        }
        
        .test-text {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
            min-height: 250px;
            max-height: 300px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        .test-text-content {
            line-height: 1.8;
        }
        
        .test-text span {
            transition: all 0.1s ease;
            word-wrap: break-word;
            white-space: pre-wrap;
            display: inline;
            position: relative;
        }
        
        .test-text span.correct {
            color: var(--success);
        }
        
        .test-text span.incorrect {
            color: var(--danger);
            background: rgba(249, 65, 68, 0.2);
            border-radius: 3px;
        }
        
        .test-text span.current {
            background: rgba(67, 97, 238, 0.3);
            border-radius: 3px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { background-color: rgba(67, 97, 238, 0.3); }
            51%, 100% { background-color: transparent; }
        }
        
        .input-area {
            margin-top: 20px;
        }
        
        #typing-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 18px;
            font-size: 1.2rem;
            color: white;
            outline: none;
            transition: border 0.3s;
        }
        
        #typing-input:focus {
            border-color: var(--primary);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-accent {
            background: linear-gradient(to right, var(--accent), #b5179e);
            color: white;
        }
        
        .btn-accent:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(248, 37, 133, 0.4);
        }
        
        /* Score History Panel */
        .history-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .history-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .history-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .history-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 12px;
            border-left: 5px solid var(--primary);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .history-user {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .history-user i {
            font-size: 0.8rem;
        }
        
        .history-title {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--light);
            margin-bottom: 6px;
        }
        
        .history-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .history-date {
            font-size: 0.7rem;
            color: #aaa;
            text-align: right;
        }
        
        .history-points {
            color: var(--warning);
            font-weight: 600;
        }
        
        .no-history {
            text-align: center;
            padding: 30px;
            color: #aaa;
            font-style: italic;
        }
        
        .clear-history-btn {
            background: rgba(249, 65, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(249, 65, 68, 0.3);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            width: 100%;
        }
        
        .clear-history-btn:hover {
            background: rgba(249, 65, 68, 0.3);
        }
        
        /* User Registration Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .registration-modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .modal-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--success);
        }
        
        .modal-subtitle {
            color: #aaa;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--light);
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .age-group {
            display: flex;
            gap: 10px;
        }
        
        .age-input {
            flex: 1;
        }
        
        .welcome-message {
            margin-top: 30px;
            padding: 20px;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 15px;
            border-left: 5px solid var(--primary);
        }
        
        /* Results Panel */
        .results-panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            z-index: 100;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .results-title {
            font-size: 1.8rem;
            color: var(--success);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border-top: 5px solid var(--primary);
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 5px;
        }
        
        .result-label {
            font-size: 1rem;
            color: #aaa;
        }
        
        .accuracy-meter {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            position: relative;
        }
        
        .accuracy-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .accuracy-circle {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .accuracy-bg {
            stroke: rgba(255, 255, 255, 0.1);
        }
        
        .accuracy-fill {
            stroke: var(--success);
            stroke-dasharray: 440;
            stroke-dashoffset: 440;
            transition: stroke-dashoffset 1.5s ease;
        }
        
        .points-earned {
            text-align: center;
            font-size: 1.5rem;
            color: var(--warning);
            margin: 20px 0;
            font-weight: 700;
        }
        
        .points-earned i {
            margin-right: 10px;
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .completed-badge {
            background: var(--success);
            color: var(--dark);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 600;
            position: absolute;
            top: 10px;
            left: 10px;
        }
        
        /* Achievement Badge */
        .achievement-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: var(--dark);
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 5px;
        }
        
        /* Overlay for results panel */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 99;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Overlay for results -->
    <div class="overlay" id="overlay"></div>
    
    <!-- User Registration Modal -->
    <div class="modal-overlay" id="registration-modal">
        <div class="registration-modal">
            <h2 class="modal-title">Welcome to TypeMaster Pro!</h2>
            <p class="modal-subtitle">Made by Mohd Umair</p>
            
            <form id="registration-form">
                <div class="form-group">
                    <label class="form-label" for="user-name">Your Name</label>
                    <input type="text" id="user-name" class="form-input" placeholder="Enter your Name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="user-age">Your Age</label>
                    <div class="age-group">
                        <input type="number" id="user-age" class="form-input age-input" min="5" max="100" placeholder="Age" required>
                        <select id="user-level" class="form-input" style="flex: 0.8; background-color: #30344a;">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>
                
                <div class="welcome-message">
                    <p><i class="fas fa-info-circle"></i> Your progress will be saved automatically. You'll earn points for completing lessons and achieving high accuracy!</p>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-unlock"></i> Start Typing Journey
                </button>
            </form>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="container" id="main-app" style="display: none;">
        <!-- User Points Display with Logout Button -->
        <div class="user-info-bar">
            <div class="user-name-display" id="user-name-display">Guest</div>
            <div class="points-display">
                <i class="fas fa-coins" style="color: var(--warning);"></i>
                <span class="points-value" id="total-points">0</span>
                <span>Points</span>
            </div>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <header>
            <h1 class="logo floating">TypeMaster Pro</h1>
            <p class="tagline">Master touch typing with advanced lessons and punctuation practice!</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="lessons-tab">
                <i class="fas fa-keyboard"></i> Basic Lessons
            </button>
            <button class="tab-btn" data-tab="paragraph-tab">
                <i class="fas fa-paragraph"></i> Paragraph Practice
            </button>
            <button class="tab-btn" data-tab="advanced-tab">
                <i class="fas fa-star"></i> Advanced Practice
            </button>
            <button class="tab-btn" data-tab="history-tab">
                <i class="fas fa-history"></i> Score History
            </button>
        </div>
        
        <div class="main-content">
            <!-- Simplified Lessons Panel -->
            <div class="lessons-panel">
                <h2 class="panel-title"><i class="fas fa-graduation-cap"></i> 
                    <span id="panel-title-text">Basic Lessons</span>
                </h2>
                <div class="lessons-list" id="lessons-list">
                    <!-- Lessons will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Typing Test Panel -->
            <div class="typing-panel">
                <div class="test-header">
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value" id="wpm">0</div>
                            <div class="stat-label">WPM</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="accuracy">100%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="errors">0</div>
                            <div class="stat-label">Errors</div>
                        </div>
                    </div>
                    <div class="timer" id="timer">60</div>
                </div>
                
                <div class="test-text" id="test-text">
                    <div class="test-text-content" id="test-text-content">
                        <!-- Text for typing test will appear here -->
                    </div>
                </div>
                
                <div class="input-area">
                    <input type="text" id="typing-input" placeholder="Start typing here when the test begins..." autocomplete="off" disabled>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="start-btn">
                        <i class="fas fa-play"></i> Start Test
                    </button>
                    <button class="btn btn-secondary" id="reset-btn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button class="btn btn-accent" id="next-lesson-btn">
                        <i class="fas fa-forward"></i> Next Lesson
                    </button>
                </div>
            </div>
            
            <!-- Score History Panel -->
            <div class="history-panel">
                <h2 class="panel-title"><i class="fas fa-chart-line"></i> Score History</h2>
                <div class="history-list" id="history-list">
                    <!-- Score history will be generated by JavaScript -->
                </div>
                <button class="clear-history-btn" id="clear-history-btn">
                    <i class="fas fa-trash"></i> Clear History
                </button>
            </div>
        </div>
        
        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <h2 class="results-title">Test Completed!</h2>
            
            <div class="accuracy-meter">
                <svg width="150" height="150" viewBox="0 0 150 150">
                    <circle class="accuracy-circle accuracy-bg" cx="75" cy="75" r="70"></circle>
                    <circle class="accuracy-circle accuracy-fill" cx="75" cy="75" r="70" id="accuracy-circle"></circle>
                </svg>
                <div class="accuracy-value" id="final-accuracy">100%</div>
            </div>
            
            <div class="points-earned" id="points-earned">
                <i class="fas fa-coins"></i> +<span id="earned-points">0</span> Points Earned!
            </div>
            
            <div class="results-stats">
                <div class="result-box">
                    <div class="result-value" id="final-wpm">0</div>
                    <div class="result-label">Words Per Minute</div>
                </div>
                <div class="result-box">
                    <div class="result-value" id="final-accuracy-val">100%</div>
                    <div class="result-label">Accuracy</div>
                </div>
                <div class="result-box">
                    <div class="result-value" id="final-errors">0</div>
                    <div class="result-label">Errors</div>
                </div>
                <div class="result-box">
                    <div class="result-value" id="final-time">60s</div>
                    <div class="result-label">Time Taken</div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-primary" id="try-again-btn">
                    <i class="fas fa-redo"></i> Try Again
                </button>
                <button class="btn btn-secondary" id="continue-btn">
                    <i class="fas fa-forward"></i> Continue
                </button>
            </div>
        </div>
        
        <footer>
            <p>TypeMaster Pro &copy; 2026 | Practice regularly to improve your typing speed and accuracy</p>
            <p>Complete lessons to unlock advanced punctuation, numbers, and challenging typing exercises!</p>
            <p>Build By Mohd Umair</p>
        </footer>
    </div>

    <script>
        // Typing lessons data
        const basicLessons = [
            {
                id: 1,
                title: "Home Row Basics",
                text: "asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl; asdf jkl;",
                difficulty: "beginner",
                time: 60,
                type: "basic",
                points: 50,
                unlocked: true,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 2,
                title: "Index Finger Practice",
                text: "rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm rfv ujm",
                difficulty: "beginner",
                time: 60,
                type: "basic",
                points: 50,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 3,
                title: "Middle Finger Practice",
                text: "dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki, dec ki,",
                difficulty: "beginner",
                time: 60,
                type: "basic",
                points: 50,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 4,
                title: "Common Words",
                text: "the and for are but not you all can her was one day get him see now how man out its who been she",
                difficulty: "intermediate",
                time: 60,
                type: "basic",
                points: 75,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 5,
                title: "Short Sentences",
                text: "The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs. How vexingly quick daft zebras jump.",
                difficulty: "intermediate",
                time: 60,
                type: "basic",
                points: 75,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            }
        ];

        // Paragraph lessons data with punctuation
        const paragraphLessons = [
            {
                id: 1,
                title: "Nature Paragraph",
                text: "The gentle rustle of leaves in the wind creates a soothing symphony that calms the mind and rejuvenates the spirit. Sunlight filters through the canopy, casting dappled shadows on the forest floor where wildflowers bloom in vibrant hues. Birds sing their melodious tunes from hidden perches, adding to the serene ambiance of this natural sanctuary.",
                difficulty: "intermediate",
                time: 90,
                type: "paragraph",
                points: 100,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 2,
                title: "Technology & Punctuation",
                text: "In the digital age, technology evolves rapidly: artificial intelligence, quantum computing, and blockchain are transforming industries. However, we must ask: \"What are the ethical implications?\" These advancements—while exciting—require careful consideration; after all, progress should benefit everyone, not just a select few.",
                difficulty: "advanced",
                time: 90,
                type: "paragraph",
                points: 125,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 3,
                title: "Health & Wellness",
                text: "Maintaining a healthy lifestyle requires consistent effort—exercise, nutrition, sleep, and stress management. Remember: \"Health is wealth!\" Regular activity (30+ minutes daily) strengthens both body and mind; meanwhile, balanced meals—including fruits, vegetables, and proteins—provide essential nutrients for optimal function.",
                difficulty: "advanced",
                time: 90,
                type: "paragraph",
                points: 125,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 4,
                title: "Space Exploration",
                text: "Space exploration represents humanity's greatest ambition: to understand our universe. Missions to Mars, Europa, and beyond seek answers to fundamental questions—\"Are we alone?\" \"Can we survive elsewhere?\" These endeavors, while costly ($ billions annually), push technological boundaries and inspire future generations of scientists, engineers, and dreamers.",
                difficulty: "expert",
                time: 120,
                type: "paragraph",
                points: 150,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            }
        ];

        // Advanced lessons with numbers and special characters
        const advancedLessons = [
            {
                id: 1,
                title: "Number Practice",
                text: "123 456 789 0 12 34 56 78 90 100 200 300 400 500 600 700 800 900 1000. Phone: 555-123-4567. Date: 12/25/2023. Time: 3:45 PM. Temperature: 98.6°F. Percentage: 75%. Score: 8.5/10.",
                difficulty: "intermediate",
                time: 90,
                type: "advanced",
                points: 100,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 2,
                title: "Special Characters",
                text: "@#$%^&*()_+-=[]{}|;':\",./<>?~`! Practice these symbols: @email.com, #hashtag, $100, 25%, 5^2=25, a&b, 10*5=50, (parentheses), _underscore_, +plus-, [brackets], {braces}, |pipe|, ;semicolon; 'single', \"double\", /slash/, <less> >greater?, ~tilde~, !exclamation!",
                difficulty: "advanced",
                time: 120,
                type: "advanced",
                points: 150,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 3,
                title: "Programming Syntax",
                text: "function calculateScore(wpm, accuracy) { const score = (wpm * accuracy) / 100; return Math.round(score); } // Example usage: const result = calculateScore(65, 92); console.log('Final score:', result); if(result > 50) { console.log('Excellent!'); } else { console.log('Keep practicing!'); }",
                difficulty: "expert",
                time: 150,
                type: "advanced",
                points: 200,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 4,
                title: "Mixed Challenge",
                text: "Email: john.doe@company-123.com | Phone: +1 (800) 555-0199 | Date: December 31, 2023 | Time: 11:59:59 PM | Price: $1,299.99 (15% discount) | Formula: E=mc^2 | Code: <div id='main'>Content</div> | Math: √25=5, π≈3.14159, 2³=8 | Special: ©™® § ¶ † ‡ • … – —",
                difficulty: "master",
                time: 180,
                type: "advanced",
                points: 300,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            },
            {
                id: 5,
                title: "Finance & Data Entry",
                text: "Transaction #789012: Date: 10/15/2023, Amount: $2,450.75, Account: 4083-XXXX-2234-5567, Reference: INVOICE-7890. Quarterly Report: Revenue ↑15.3% ($4.2M), Expenses ↓8.7% ($2.1M), Net Profit: $2.1M (+24%). Forecast Q4: $4.8M-5.2M. Exchange Rates: €1=$1.08, £1=$1.27, ¥100=$0.69.",
                difficulty: "master",
                time: 180,
                type: "advanced",
                points: 300,
                unlocked: false,
                completed: false,
                bestScore: 0,
                hasEarnedPoints: false
            }
        ];

        // DOM Elements
        const registrationModal = document.getElementById('registration-modal');
        const mainApp = document.getElementById('main-app');
        const registrationForm = document.getElementById('registration-form');
        const logoutBtn = document.getElementById('logout-btn');
        const userNameDisplay = document.getElementById('user-name-display');
        const totalPointsElement = document.getElementById('total-points');
        const lessonsList = document.getElementById('lessons-list');
        const testTextContent = document.getElementById('test-text-content');
        const typingInput = document.getElementById('typing-input');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextLessonBtn = document.getElementById('next-lesson-btn');
        const timerElement = document.getElementById('timer');
        const wpmElement = document.getElementById('wpm');
        const accuracyElement = document.getElementById('accuracy');
        const errorsElement = document.getElementById('errors');
        const resultsPanel = document.getElementById('results-panel');
        const overlay = document.getElementById('overlay');
        const finalWpm = document.getElementById('final-wpm');
        const finalAccuracy = document.getElementById('final-accuracy');
        const finalAccuracyVal = document.getElementById('final-accuracy-val');
        const finalErrors = document.getElementById('final-errors');
        const finalTime = document.getElementById('final-time');
        const accuracyCircle = document.getElementById('accuracy-circle');
        const tryAgainBtn = document.getElementById('try-again-btn');
        const continueBtn = document.getElementById('continue-btn');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const panelTitleText = document.getElementById('panel-title-text');
        const earnedPointsElement = document.getElementById('earned-points');
        const pointsEarnedSection = document.getElementById('points-earned');

        // User data
        let userData = {
            name: "",
            age: 0,
            level: "beginner",
            totalPoints: 0,
            lessonsUnlocked: 1,
            completedLessons: 0
        };

        // Game State
        let currentLessonType = "basic";
        let currentLessons = basicLessons;
        let currentLessonIndex = 0;
        let currentText = "";
        let typedText = "";
        let startTime = 0;
        let timer = null;
        let timeLeft = 60;
        let isTestActive = false;
        let errors = 0;
        let correctChars = 0;
        let totalChars = 0;
        let scoreHistory = [];
        let hasCompletedCurrentTest = false;

        // Initialize the app
        function init() {
            loadUserData();
            loadScoreHistory();
            loadLessonsProgress();
            
            // If user is not registered, show registration modal
            if (!userData.name) {
                showRegistrationModal();
            } else {
                showMainApp();
            }
            
            // Event Listeners
            registrationForm.addEventListener('submit', handleRegistration);
            logoutBtn.addEventListener('click', handleLogout);
            startBtn.addEventListener('click', startTest);
            resetBtn.addEventListener('click', resetTest);
            nextLessonBtn.addEventListener('click', nextLesson);
            tryAgainBtn.addEventListener('click', tryAgain);
            continueBtn.addEventListener('click', continueTest);
            typingInput.addEventListener('input', handleTyping);
            clearHistoryBtn.addEventListener('click', clearHistory);
            overlay.addEventListener('click', hideResults);
            
            // Tab switching
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    switchTab(tabId, button);
                });
            });
        }

        // Show registration modal
        function showRegistrationModal() {
            registrationModal.style.display = 'flex';
            mainApp.style.display = 'none';
            
            // Clear form fields
            document.getElementById('user-name').value = '';
            document.getElementById('user-age').value = '';
            document.getElementById('user-level').value = 'beginner';
        }

        // Show main app
        function showMainApp() {
            registrationModal.style.display = 'none';
            mainApp.style.display = 'block';
            updateUserDisplay();
            renderLessons();
            selectLesson(0);
            renderHistory();
        }

        // Handle user registration
        function handleRegistration(e) {
            e.preventDefault();
            
            const userName = document.getElementById('user-name').value;
            const userAge = parseInt(document.getElementById('user-age').value);
            const userLevel = document.getElementById('user-level').value;
            
            if (!userName || !userAge || userAge < 5 || userAge > 100) {
                alert("Please enter a valid name and age (5-100)");
                return;
            }
            
            // Save user data
            userData.name = userName;
            userData.age = userAge;
            userData.level = userLevel;
            userData.totalPoints = 0;
            userData.lessonsUnlocked = 1;
            userData.completedLessons = 0;
            
            saveUserData();
            
            // Show main app
            showMainApp();
            
            // Unlock lessons based on user level
            unlockLessonsBasedOnLevel();
        }

        // Handle logout
        function handleLogout() {
            if (confirm("Are you sure you want to logout? Your progress will be saved.")) {
                // Clear current user session data but keep progress in localStorage
                userData.name = "";
                userData.age = 0;
                userData.level = "beginner";
                
                // Save empty user data
                saveUserData();
                
                // Reset game state
                resetTest();
                hideResults();
                
                // Show registration modal
                showRegistrationModal();
                
                // Show logout confirmation message
                setTimeout(() => {
                    alert("You have been logged out successfully. You can register again or login with different credentials.");
                }, 100);
            }
        }

        // Unlock lessons based on user's selected level
        function unlockLessonsBasedOnLevel() {
            const level = userData.level;
            
            // Reset all lessons first
            resetAllLessons();
            
            if (level === "beginner") {
                // Unlock first 2 basic lessons
                basicLessons.forEach((lesson, index) => {
                    if (index < 2) lesson.unlocked = true;
                });
                // Don't unlock paragraph or advanced lessons for beginners
            } else if (level === "intermediate") {
                // Unlock all basic lessons
                basicLessons.forEach(lesson => lesson.unlocked = true);
                // Unlock first 2 paragraph lessons
                paragraphLessons.forEach((lesson, index) => {
                    if (index < 2) lesson.unlocked = true;
                });
                // Unlock first advanced lesson
                advancedLessons[0].unlocked = true;
                userData.lessonsUnlocked = basicLessons.length + 2 + 1;
            } else if (level === "advanced") {
                // Unlock all lessons
                basicLessons.forEach(lesson => lesson.unlocked = true);
                paragraphLessons.forEach(lesson => lesson.unlocked = true);
                advancedLessons.forEach(lesson => lesson.unlocked = true);
                userData.lessonsUnlocked = basicLessons.length + paragraphLessons.length + advancedLessons.length;
            }
            
            saveLessonsProgress();
            renderLessons();
        }

        // Reset all lessons to default state
        function resetAllLessons() {
            // Reset basic lessons
            basicLessons.forEach((lesson, index) => {
                lesson.unlocked = index === 0; // Only first lesson unlocked by default
                lesson.completed = false;
                lesson.hasEarnedPoints = false;
            });
            
            // Reset paragraph lessons
            paragraphLessons.forEach(lesson => {
                lesson.unlocked = false;
                lesson.completed = false;
                lesson.hasEarnedPoints = false;
            });
            
            // Reset advanced lessons
            advancedLessons.forEach(lesson => {
                lesson.unlocked = false;
                lesson.completed = false;
                lesson.hasEarnedPoints = false;
            });
        }

        // Update user display in top right corner
        function updateUserDisplay() {
            userNameDisplay.textContent = userData.name;
            totalPointsElement.textContent = userData.totalPoints;
        }

        // Save user data to localStorage
        function saveUserData() {
            localStorage.setItem('typingUserData', JSON.stringify(userData));
        }

        // Load user data from localStorage
        function loadUserData() {
            const savedData = localStorage.getItem('typingUserData');
            if (savedData) {
                userData = JSON.parse(savedData);
            }
        }

        // Load score history from localStorage
        function loadScoreHistory() {
            const savedHistory = localStorage.getItem('typingTestHistory');
            if (savedHistory) {
                scoreHistory = JSON.parse(savedHistory);
            }
        }

        // Save score history to localStorage
        function saveScoreHistory() {
            localStorage.setItem('typingTestHistory', JSON.stringify(scoreHistory));
        }

        // Save a test result to history
        function saveTestResult(wpm, accuracy, errors, timeTaken, lessonTitle, lessonType, pointsEarned) {
            const result = {
                id: Date.now(),
                date: new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                userName: userData.name,
                wpm: wpm,
                accuracy: accuracy,
                errors: errors,
                time: timeTaken,
                lesson: lessonTitle,
                type: lessonType,
                points: pointsEarned
            };
            
            scoreHistory.unshift(result);
            
            // Keep only last 50 results
            if (scoreHistory.length > 50) {
                scoreHistory = scoreHistory.slice(0, 50);
            }
            
            saveScoreHistory();
            renderHistory();
        }

        // Render score history with user name
        function renderHistory() {
            historyList.innerHTML = "";
            
            if (scoreHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="no-history">
                        <i class="fas fa-history fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No test results yet</p>
                        <p style="font-size: 0.9rem;">Complete a typing test to see your history here</p>
                    </div>
                `;
                return;
            }
            
            scoreHistory.forEach(result => {
                const historyCard = document.createElement('div');
                historyCard.className = 'history-card';
                
                // Get user name or show "Unknown User" if not available
                const userName = result.userName || "Unknown User";
                
                historyCard.innerHTML = `
                    <div class="history-header">
                        <div class="history-user">
                            <i class="fas fa-user"></i> ${userName}
                        </div>
                        <div class="history-points">
                            <i class="fas fa-coins"></i> +${result.points}
                        </div>
                    </div>
                    <div class="history-title">${result.lesson} (${result.type})</div>
                    <div class="history-stats">
                        <span><i class="fas fa-tachometer-alt"></i> ${result.wpm} WPM</span>
                        <span><i class="fas fa-bullseye"></i> ${result.accuracy}%</span>
                    </div>
                    <div class="history-stats">
                        <span><i class="fas fa-times-circle"></i> ${result.errors} errors</span>
                        <span><i class="fas fa-clock"></i> ${result.time}s</span>
                    </div>
                    <div class="history-date">${result.date}</div>
                `;
                historyList.appendChild(historyCard);
            });
        }

        // Clear all history
        function clearHistory() {
            if (scoreHistory.length === 0) return;
            
            if (confirm("Are you sure you want to clear all your test history? This action cannot be undone.")) {
                scoreHistory = [];
                saveScoreHistory();
                renderHistory();
            }
        }

        // Switch between tabs
        function switchTab(tabId, button) {
            // Update active tab button
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Update lessons based on tab
            if (tabId === 'lessons-tab') {
                currentLessonType = "basic";
                currentLessons = basicLessons;
                panelTitleText.textContent = "Basic Lessons";
            } else if (tabId === 'paragraph-tab') {
                currentLessonType = "paragraph";
                currentLessons = paragraphLessons;
                panelTitleText.textContent = "Paragraph Practice";
            } else if (tabId === 'advanced-tab') {
                currentLessonType = "advanced";
                currentLessons = advancedLessons;
                panelTitleText.textContent = "Advanced Practice";
            } else if (tabId === 'history-tab') {
                panelTitleText.textContent = "Score History";
                renderHistory();
                return;
            }
            
            // Reset to first unlocked lesson of the new type
            const firstUnlockedIndex = currentLessons.findIndex(lesson => lesson.unlocked);
            if (firstUnlockedIndex !== -1) {
                currentLessonIndex = firstUnlockedIndex;
                renderLessons();
                selectLesson(currentLessonIndex);
            } else {
                // If no lessons unlocked, show message
                lessonsList.innerHTML = `
                    <div class="no-history">
                        <i class="fas fa-lock fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Lessons Locked</p>
                        <p style="font-size: 0.9rem;">Complete previous lessons to unlock more</p>
                    </div>
                `;
                // Clear test area
                testTextContent.innerHTML = "";
                typingInput.disabled = true;
                typingInput.placeholder = "Unlock lessons to practice";
            }
        }

        // Render lessons list (simplified version)
        function renderLessons() {
            lessonsList.innerHTML = "";
            
            currentLessons.forEach((lesson, index) => {
                const lessonCard = document.createElement('div');
                lessonCard.className = `lesson-card ${index === currentLessonIndex ? 'active' : ''} ${lesson.completed ? 'completed' : ''} ${!lesson.unlocked ? 'locked' : ''}`;
                
                let completedBadge = "";
                if (lesson.completed) {
                    completedBadge = `<span class="completed-badge">Completed</span>`;
                }
                
                // Get difficulty color class
                const difficultyClass = `difficulty-${lesson.difficulty}`;
                
                lessonCard.innerHTML = `
                    ${completedBadge}
                    <div class="lesson-points">+${lesson.points}</div>
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-meta">
                        <div class="lesson-time">
                            <i class="fas fa-clock"></i> ${lesson.time}s
                        </div>
                        <div class="lesson-difficulty">
                            <i class="fas fa-signal"></i> 
                            <span class="${difficultyClass}">${lesson.difficulty.charAt(0).toUpperCase() + lesson.difficulty.slice(1)}</span>
                        </div>
                    </div>
                `;
                
                if (lesson.unlocked) {
                    lessonCard.addEventListener('click', () => selectLesson(index));
                } else {
                    lessonCard.addEventListener('click', () => {
                        alert(`Complete previous lessons to unlock "${lesson.title}"`);
                    });
                }
                
                lessonsList.appendChild(lessonCard);
            });
        }

        // Select a lesson
        function selectLesson(index) {
            if (isTestActive) return;
            if (!currentLessons[index].unlocked) return;
            
            // Update active lesson
            document.querySelectorAll('.lesson-card').forEach(card => {
                card.classList.remove('active');
            });
            
            document.querySelectorAll('.lesson-card')[index].classList.add('active');
            
            // Set current lesson
            currentLessonIndex = index;
            currentText = currentLessons[index].text;
            timeLeft = currentLessons[index].time;
            timerElement.textContent = timeLeft;
            
            // Reset the hasEarnedPoints flag for this lesson if not completed
            if (!currentLessons[index].completed) {
                currentLessons[index].hasEarnedPoints = false;
            }
            
            // Display text
            displayText();
            
            // Reset stats
            resetStats();
            hasCompletedCurrentTest = false;
        }

        // Display the text for typing (fixed to prevent overlapping)
        function displayText() {
            testTextContent.innerHTML = "";
            
            // Split text into characters and wrap each in span
            for (let i = 0; i < currentText.length; i++) {
                const charSpan = document.createElement('span');
                charSpan.textContent = currentText[i];
                charSpan.id = `char-${i}`;
                testTextContent.appendChild(charSpan);
            }
            
            // Highlight first character
            if (currentText.length > 0) {
                document.getElementById('char-0').classList.add('current');
            }
        }

        // Start the test
        function startTest() {
            if (isTestActive) return;
            if (hasCompletedCurrentTest) {
                alert("This test is already completed. Please select 'Try Again' or choose another lesson.");
                return;
            }
            
            isTestActive = true;
            startTime = Date.now();
            typedText = "";
            errors = 0;
            correctChars = 0;
            totalChars = 0;
            
            // Enable input and focus
            typingInput.disabled = false;
            typingInput.value = "";
            typingInput.focus();
            
            // Start timer
            timer = setInterval(updateTimer, 1000);
            
            // Update button
            startBtn.innerHTML = '<i class="fas fa-pause"></i> Pause Test';
            startBtn.classList.remove('btn-primary');
            startBtn.classList.add('btn-accent');
            
            // Remove click event and add pause event
            startBtn.removeEventListener('click', startTest);
            startBtn.addEventListener('click', pauseTest);
        }

        // Pause the test
        function pauseTest() {
            if (!isTestActive) return;
            
            isTestActive = false;
            clearInterval(timer);
            
            // Disable input
            typingInput.disabled = true;
            
            // Update button
            startBtn.innerHTML = '<i class="fas fa-play"></i> Resume Test';
            startBtn.classList.remove('btn-accent');
            startBtn.classList.add('btn-primary');
            
            // Remove pause event and add resume event
            startBtn.removeEventListener('click', pauseTest);
            startBtn.addEventListener('click', resumeTest);
        }

        // Resume the test
        function resumeTest() {
            if (isTestActive) return;
            
            isTestActive = true;
            startTime = Date.now() - (currentLessons[currentLessonIndex].time - timeLeft) * 1000;
            
            // Enable input and focus
            typingInput.disabled = false;
            typingInput.focus();
            
            // Restart timer
            timer = setInterval(updateTimer, 1000);
            
            // Update button
            startBtn.innerHTML = '<i class="fas fa-pause"></i> Pause Test';
            startBtn.classList.remove('btn-primary');
            startBtn.classList.add('btn-accent');
            
            // Remove resume event and add pause event
            startBtn.removeEventListener('click', resumeTest);
            startBtn.addEventListener('click', pauseTest);
        }

        // Update timer
        function updateTimer() {
            timeLeft--;
            timerElement.textContent = timeLeft;
            
            // Calculate and update WPM
            updateStats();
            
            // Test finished
            if (timeLeft <= 0) {
                finishTest();
            }
        }

        // Update stats (WPM, accuracy, errors)
        function updateStats() {
            if (!isTestActive) return;
            
            // Calculate time passed in minutes
            const timePassed = (currentLessons[currentLessonIndex].time - timeLeft) / 60;
            
            // Calculate WPM (words are 5 characters)
            const words = correctChars / 5;
            const wpm = timePassed > 0 ? Math.round(words / timePassed) : 0;
            wpmElement.textContent = wpm;
            
            // Calculate accuracy
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
            accuracyElement.textContent = `${accuracy}%`;
            
            // Update errors
            errorsElement.textContent = errors;
        }

        // Handle typing input
        function handleTyping(e) {
            if (!isTestActive) return;
            
            const input = e.target.value;
            const currentIndex = input.length - 1;
            
            // Check if we're at the end of the text
            if (currentIndex >= currentText.length) {
                finishTest();
                return;
            }
            
            // Update typed text
            typedText = input;
            
            // Highlight characters
            highlightChars(currentIndex);
            
            // Update stats
            updateStats();
        }

        // Highlight characters based on typing
        function highlightChars(currentIndex) {
            // Reset all characters
            for (let i = 0; i < currentText.length; i++) {
                const charSpan = document.getElementById(`char-${i}`);
                if (charSpan) {
                    charSpan.classList.remove('correct', 'incorrect', 'current');
                }
            }
            
            // Highlight typed characters
            for (let i = 0; i < typedText.length; i++) {
                const charSpan = document.getElementById(`char-${i}`);
                if (charSpan) {
                    if (typedText[i] === currentText[i]) {
                        charSpan.classList.add('correct');
                        if (i === typedText.length - 1) {
                            correctChars++;
                        }
                    } else {
                        charSpan.classList.add('incorrect');
                        if (i === typedText.length - 1) {
                            errors++;
                        }
                    }
                }
                
                totalChars = typedText.length;
            }
            
            // Highlight current character
            if (currentIndex < currentText.length - 1) {
                const currentCharSpan = document.getElementById(`char-${typedText.length}`);
                if (currentCharSpan) {
                    currentCharSpan.classList.add('current');
                }
            }
        }

        // Calculate points earned based on performance
        function calculatePoints(wpm, accuracy, lessonPoints) {
            let points = lessonPoints;
            
            // Bonus points for high accuracy
            if (accuracy >= 95) points += Math.round(lessonPoints * 0.5);
            else if (accuracy >= 90) points += Math.round(lessonPoints * 0.3);
            else if (accuracy >= 80) points += Math.round(lessonPoints * 0.1);
            
            // Bonus points for high speed (WPM)
            if (wpm >= 60) points += 50;
            else if (wpm >= 40) points += 30;
            else if (wpm >= 20) points += 10;
            
            // Penalty for too many errors
            if (accuracy < 70) points = Math.round(points * 0.5);
            if (accuracy < 50) points = Math.round(points * 0.2);
            
            return Math.max(10, points); // Minimum 10 points
        }

        // Show results panel
        function showResults() {
            resultsPanel.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Hide results panel
        function hideResults() {
            resultsPanel.style.display = 'none';
            overlay.style.display = 'none';
        }

        // Finish the test
        function finishTest() {
            isTestActive = false;
            clearInterval(timer);
            hasCompletedCurrentTest = true;
            
            // Disable input
            typingInput.disabled = true;
            
            // Calculate final stats
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
            const timePassed = currentLessons[currentLessonIndex].time - timeLeft;
            const wpm = timePassed > 0 ? Math.round((correctChars / 5) / (timePassed / 60)) : 0;
            
            // Check if lesson was already completed
            const currentLesson = currentLessons[currentLessonIndex];
            const wasPreviouslyCompleted = currentLesson.completed;
            const hasAlreadyEarnedPoints = currentLesson.hasEarnedPoints;
            
            let pointsEarned = 0;
            
            // Only calculate and award points if:
            // 1. Lesson wasn't completed before, OR
            // 2. It was completed but user hasn't earned points for this session yet
            if (!wasPreviouslyCompleted || !hasAlreadyEarnedPoints) {
                // Calculate points earned
                const lessonPoints = currentLesson.points;
                pointsEarned = calculatePoints(wpm, accuracy, lessonPoints);
                
                // Update user points
                userData.totalPoints += pointsEarned;
                
                // Mark that points have been earned for this lesson in this session
                currentLesson.hasEarnedPoints = true;
                
                // Save test result to history
                saveTestResult(
                    wpm, 
                    accuracy, 
                    errors, 
                    timePassed, 
                    currentLesson.title,
                    currentLessonType,
                    pointsEarned
                );
            }
            
            // Check if lesson should be marked as completed
            if (!wasPreviouslyCompleted && accuracy >= 70) {
                currentLesson.completed = true;
                userData.completedLessons++;
                
                // Unlock next lesson if exists
                if (currentLessonIndex < currentLessons.length - 1) {
                    const nextLesson = currentLessons[currentLessonIndex + 1];
                    if (!nextLesson.unlocked) {
                        nextLesson.unlocked = true;
                        userData.lessonsUnlocked++;
                        
                        // Show achievement message
                        setTimeout(() => {
                            alert(`🎉 Achievement Unlocked!\nYou've unlocked "${nextLesson.title}"!`);
                        }, 500);
                    }
                }
                
                // Also unlock first paragraph lesson if all basic lessons completed
                if (currentLessonType === "basic" && userData.completedLessons >= basicLessons.length) {
                    paragraphLessons[0].unlocked = true;
                    saveLessonsProgress();
                }
                
                // Unlock first advanced lesson if all paragraph lessons completed
                if (currentLessonType === "paragraph" && 
                    paragraphLessons.every(lesson => lesson.completed || !lesson.unlocked)) {
                    advancedLessons[0].unlocked = true;
                    saveLessonsProgress();
                }
            }
            
            // Update best score
            const score = Math.round((wpm * accuracy) / 100);
            if (score > currentLesson.bestScore) {
                currentLesson.bestScore = score;
            }
            
            // Save user data and lessons progress
            saveUserData();
            saveLessonsProgress();
            
            // Update results panel
            updateResultsPanel(wpm, accuracy, errors, timePassed, pointsEarned);
            
            // Show results panel
            showResults();
            
            // Update user display
            updateUserDisplay();
            
            // Reset button to start state
            startBtn.innerHTML = '<i class="fas fa-play"></i> Start Test';
            startBtn.classList.remove('btn-accent');
            startBtn.classList.add('btn-primary');
            startBtn.removeEventListener('click', pauseTest);
            startBtn.removeEventListener('click', resumeTest);
            startBtn.addEventListener('click', startTest);
            
            // Re-render lessons to update progress and unlocked status
            renderLessons();
        }

        // Save lessons progress to localStorage
        function saveLessonsProgress() {
            localStorage.setItem("basicLessonsProgress", JSON.stringify(basicLessons));
            localStorage.setItem("paragraphLessonsProgress", JSON.stringify(paragraphLessons));
            localStorage.setItem("advancedLessonsProgress", JSON.stringify(advancedLessons));
        }

        // Load lessons progress from localStorage
        function loadLessonsProgress() {
            const basicProgress = localStorage.getItem("basicLessonsProgress");
            const paragraphProgress = localStorage.getItem("paragraphLessonsProgress");
            const advancedProgress = localStorage.getItem("advancedLessonsProgress");
            
            if (basicProgress) {
                const savedBasic = JSON.parse(basicProgress);
                basicLessons.forEach((lesson, index) => {
                    if (savedBasic[index]) {
                        lesson.completed = savedBasic[index].completed || false;
                        lesson.unlocked = savedBasic[index].unlocked || lesson.unlocked;
                        lesson.bestScore = savedBasic[index].bestScore || 0;
                        lesson.hasEarnedPoints = savedBasic[index].hasEarnedPoints || false;
                    }
                });
            }
            
            if (paragraphProgress) {
                const savedParagraph = JSON.parse(paragraphProgress);
                paragraphLessons.forEach((lesson, index) => {
                    if (savedParagraph[index]) {
                        lesson.completed = savedParagraph[index].completed || false;
                        lesson.unlocked = savedParagraph[index].unlocked || lesson.unlocked;
                        lesson.bestScore = savedParagraph[index].bestScore || 0;
                        lesson.hasEarnedPoints = savedParagraph[index].hasEarnedPoints || false;
                    }
                });
            }
            
            if (advancedProgress) {
                const savedAdvanced = JSON.parse(advancedProgress);
                advancedLessons.forEach((lesson, index) => {
                    if (savedAdvanced[index]) {
                        lesson.completed = savedAdvanced[index].completed || false;
                        lesson.unlocked = savedAdvanced[index].unlocked || lesson.unlocked;
                        lesson.bestScore = savedAdvanced[index].bestScore || 0;
                        lesson.hasEarnedPoints = savedAdvanced[index].hasEarnedPoints || false;
                    }
                });
            }
        }

        // Update results panel with final stats
        function updateResultsPanel(wpm, accuracy, errors, timePassed, pointsEarned) {
            // Update values
            finalWpm.textContent = wpm;
            finalAccuracy.textContent = `${accuracy}%`;
            finalAccuracyVal.textContent = `${accuracy}%`;
            finalErrors.textContent = errors;
            finalTime.textContent = `${timePassed}s`;
            earnedPointsElement.textContent = pointsEarned;
            
            // Show or hide points earned section
            if (pointsEarned > 0) {
                pointsEarnedSection.style.display = 'block';
            } else {
                pointsEarnedSection.style.display = 'none';
            }
            
            // Update accuracy circle
            const circumference = 440;
            const offset = circumference - (accuracy / 100) * circumference;
            accuracyCircle.style.strokeDashoffset = offset;
        }

        // Reset the test
        function resetTest() {
            if (isTestActive) {
                clearInterval(timer);
            }
            
            isTestActive = false;
            hasCompletedCurrentTest = false;
            timeLeft = currentLessons[currentLessonIndex].time;
            typedText = "";
            errors = 0;
            correctChars = 0;
            totalChars = 0;
            
            // Reset UI
            timerElement.textContent = timeLeft;
            wpmElement.textContent = "0";
            accuracyElement.textContent = "100%";
            errorsElement.textContent = "0";
            
            // Reset input
            typingInput.value = "";
            typingInput.disabled = true;
            typingInput.placeholder = "Start typing here when the test begins...";
            
            // Reset button
            startBtn.innerHTML = '<i class="fas fa-play"></i> Start Test';
            startBtn.classList.remove('btn-accent');
            startBtn.classList.add('btn-primary');
            startBtn.removeEventListener('click', pauseTest);
            startBtn.removeEventListener('click', resumeTest);
            startBtn.addEventListener('click', startTest);
            
            // Hide results
            hideResults();
            
            // Reset text highlighting
            displayText();
        }

        // Move to next lesson
        function nextLesson() {
            // Find next unlocked lesson
            let nextIndex = -1;
            for (let i = currentLessonIndex + 1; i < currentLessons.length; i++) {
                if (currentLessons[i].unlocked) {
                    nextIndex = i;
                    break;
                }
            }
            
            if (nextIndex !== -1) {
                selectLesson(nextIndex);
                resetTest();
                hideResults();
            } else {
                // If no next unlocked lesson, go to first unlocked
                const firstUnlockedIndex = currentLessons.findIndex(lesson => lesson.unlocked);
                if (firstUnlockedIndex !== -1) {
                    selectLesson(firstUnlockedIndex);
                    resetTest();
                    hideResults();
                }
            }
        }

        // Try again the same lesson
        function tryAgain() {
            resetTest();
            hideResults();
        }

        // Continue to next lesson after completing
        function continueTest() {
            hideResults();
            
            // Find next unlocked lesson
            let nextIndex = -1;
            for (let i = currentLessonIndex + 1; i < currentLessons.length; i++) {
                if (currentLessons[i].unlocked) {
                    nextIndex = i;
                    break;
                }
            }
            
            if (nextIndex !== -1) {
                selectLesson(nextIndex);
                resetTest();
            } else {
                // If no next unlocked lesson, go to first unlocked
                const firstUnlockedIndex = currentLessons.findIndex(lesson => lesson.unlocked);
                if (firstUnlockedIndex !== -1) {
                    selectLesson(firstUnlockedIndex);
                    resetTest();
                }
            }
        }

        // Reset stats
        function resetStats() {
            wpmElement.textContent = "0";
            accuracyElement.textContent = "100%";
            errorsElement.textContent = "0";
        }

        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>


